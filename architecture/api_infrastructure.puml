@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

HIDE_STEREOTYPE()

title Code diagram for Infrastructure Data Component - API Application

Boundary(queries, "Infrastructure Data Component") {

    namespace Domain {
        interface IRepository<T> {
            Add()
            Remove()
            GetAsync()
            SaveChangesAsync()
        }

        interface IWeatherForecastRepository implements IRepository

        interface IAggregate
    }

    namespace Application {

        interface IWeatherForecastQueries {
            GetAllWeatherForecastAsync()
        }
    }

    namespace Common.EF {
        
        abstract class BaseDbContext {
            #_currentUserService

            -Audit()
            -Concurrency()

            +SaveChanges()
            +SaveChangesAsync()
        }

        abstract class BaseTransactionalDbContext extends BaseDbContext implements ITransactionalDbContext

        interface ITransactionalDbContext {
            HasActiveTransaction

            CreateExecutionStrategy()
            GetCurrentTransaction()
            BeginTransactionAsync()
            CommitTranasctionAsync()
            RollbackTransaction()
        }
        class Extensions {
            {static} +UpdateManyToMany()
            {static} +MigrateDbContext()
        }
    }

    namespace Data {
        class ApiDbContext extends Common.EF.BaseTransactionalDbContext implements IApiDbContext
        class WeatherForcastEntityTypeConfiguration {
            +Configure()
        }

        interface IApiDbContext {
            WeatherForcasts
            SaveChangesAsync()
        }
    }

    namespace Repositories {
        class WeatherForecastRepository implements Domain.IWeatherForecastRepository {
            -_context
        }
    }

    namespace Queries {
        class WeatherForecastQueries implements Application.IWeatherForecastQueries {
            -_context
        }
    }
}

Lay_U(Data.IApiDbContext, Common.EF.BaseTransactionalDbContext)
Lay_R(Data.IApiDbContext, Data.ApiDbContext)
Lay_U(Data.WeatherForcastEntityTypeConfiguration, Data.IApiDbContext)
Lay_R(Common.EF.Extensions, Common.EF.BaseTransactionalDbContext)

@enduml